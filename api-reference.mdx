---
title: API Reference
description: "Complete reference for all publicly exposed SDK functions and types"
mode: "wide"
---

This page documents all publicly exposed functions and types in the Raysurfer SDK.

## High-Level Client

The primary way to use Raysurfer is through the drop-in replacement client.

### RaysurferClient

Drop-in replacement for Claude Agent SDK's `ClaudeSDKClient`.

<CodeGroup>

```python Python
from raysurfer import RaysurferClient
from claude_agent_sdk import ClaudeAgentOptions

options = ClaudeAgentOptions(
    allowed_tools=["Read", "Write", "Bash"],
    system_prompt="You are a helpful assistant.",
)

async with RaysurferClient(options) as client:
    await client.query("Your task here")
    async for msg in client.response():
        print(msg)
```

```typescript TypeScript
import { RaysurferClient } from "raysurfer";

const client = new RaysurferClient({
  allowedTools: ["Read", "Write", "Bash"],
  systemPrompt: "You are a helpful assistant.",
});

for await (const msg of client.query("Your task here")) {
  console.log(msg);
}
```

</CodeGroup>

#### Constructor Parameters

**Python** — `RaysurferClient(options, workspace_id=None, namespace=None, debug=False)`:

| Parameter | Type | Description |
|-----------|------|-------------|
| `options` | `ClaudeAgentOptions` | Standard Claude Agent SDK options |
| `workspace_id` | `string` | Workspace ID for per-customer isolation (enterprise) |
| `namespace` | `string` | Custom namespace for storage/retrieval |
| `debug` | `boolean` | Enable debug logging |

**TypeScript** — `new RaysurferClient(options)` where options is a single object:

| Parameter | Type | Description |
|-----------|------|-------------|
| `allowedTools` | `string[]` | Allowed Claude tools |
| `systemPrompt` | `string` | System prompt |
| `model` | `string` | Claude model ID |
| `workspaceId` | `string` | Workspace ID for per-customer isolation (enterprise) |
| `namespace` | `string` | Custom namespace for storage/retrieval |
| `debug` | `boolean` | Enable debug logging |

#### Methods

| Method | Description |
|--------|-------------|
| `query(prompt)` | Send a query with automatic cache retrieval |
| `response()` | Async generator yielding response messages (Python only) |

---

## Low-Level API Client

For custom integrations, use the direct API client.

### RaySurfer / AsyncRaySurfer

<CodeGroup>

```python Python
from raysurfer import RaySurfer, AsyncRaySurfer

# Sync client
client = RaySurfer(api_key="your_api_key")

# Async client
async with AsyncRaySurfer(api_key="your_api_key") as client:
    snips = await client.get_code_snips(task="Fetch GitHub repos")
```

```typescript TypeScript
import { RaySurfer } from "raysurfer";

const client = new RaySurfer({ apiKey: "your_api_key" });
const snips = await client.getCodeSnips({ task: "Fetch GitHub repos" });
```

</CodeGroup>

#### Constructor Options

| Option | Type | Description |
|--------|------|-------------|
| `api_key` / `apiKey` | `string` | Your Raysurfer API key |
| `base_url` / `baseUrl` | `string` | API base URL (optional) |
| `timeout` | `number` | Request timeout in seconds/ms |
| `organization_id` / `organizationId` | `string` | Organization ID for team/enterprise namespacing |
| `workspace_id` / `workspaceId` | `string` | Workspace ID for enterprise client namespacing |
| `snips_desired` / `snipsDesired` | `"company"` \| `"client"` | Scope of private snippets |

---

## Retrieval Methods

### search

Unified search for cached code snippets. Replaces the separate `get_code_snips`, `retrieve_best`, and `get_code_files` methods.

<CodeGroup>

```python Python
result = client.search(
    task="Fetch GitHub trending repos",
    top_k=5,
    min_verdict_score=0.3,
    prefer_complete=True,
)

for match in result.matches:
    print(f"{match.code_block.name}: {match.combined_score}")
    print(f"  File: {match.filename}")
    print(f"  Verdict: {match.verdict_score:.0%}")
```

```typescript TypeScript
const result = await client.search({
  task: "Fetch GitHub trending repos",
  topK: 5,
  minVerdictScore: 0.3,
  preferComplete: true,
});

for (const match of result.matches) {
  console.log(`${match.codeBlock.name}: ${match.combinedScore}`);
  console.log(`  File: ${match.filename}`);
  console.log(`  Verdict: ${Math.round(match.verdictScore * 100)}%`);
}
```

</CodeGroup>

#### Parameters

| Parameter | Type | Default | Description |
|-----------|------|---------|-------------|
| `task` | `string` | required | Natural language task description |
| `top_k` / `topK` | `number` | `5` | Maximum number of results |
| `min_verdict_score` / `minVerdictScore` | `number` | `0.3` | Minimum verdict score filter |
| `prefer_complete` / `preferComplete` | `boolean` | `false` | Prefer longer/more complete implementations |
| `input_schema` / `inputSchema` | `object` | `null` | Optional input schema filter |

#### Returns: `SearchResponse`

| Field | Type | Description |
|-------|------|-------------|
| `matches` | `SearchMatch[]` | Matching code blocks with full scoring |
| `total_found` / `totalFound` | `number` | Total matches found |
| `cache_hit` / `cacheHit` | `boolean` | Whether results were served from cache |
| `search_namespaces` / `searchNamespaces` | `string[]` | Namespaces that were searched |

---

### get_code_snips / getCodeSnips (convenience wrapper)

Convenience wrapper around `search()`. Returns results in the legacy `RetrieveCodeBlockResponse` format.

---

### retrieve_best / retrieveBest (convenience wrapper)

Convenience wrapper around `search()`. Returns the single best match in the legacy `RetrieveBestResponse` format. The old `retrieval_confidence` string field is derived from the numeric `combined_score`.

---

### get_code_files / getCodeFiles

Get code files ready to download to a sandbox environment. Delegates to `search()` internally. Also returns a pre-formatted `add_to_llm_prompt` string (generated client-side) that you can append directly to your LLM system prompt.

<CodeGroup>

```python Python
result = client.get_code_files(
    task="Fetch GitHub user data",
    top_k=5,
    min_verdict_score=0.3,
    prefer_complete=True,
    cache_dir="/path/to/cache",  # Optional: include full paths in prompt
)

for file in result.files:
    print(f"{file.filename}: {file.verdict_score}")

# Use the pre-formatted prompt string
system_prompt = "You are helpful." + result.add_to_llm_prompt
```

```typescript TypeScript
const result = await client.getCodeFiles({
  task: "Fetch GitHub user data",
  topK: 5,
  minVerdictScore: 0.3,
  preferComplete: true,
  cacheDir: "/path/to/cache",  // Optional: include full paths in prompt
});

for (const file of result.files) {
  console.log(`${file.filename}: ${file.verdictScore}`);
}

// Use the pre-formatted prompt string
const systemPrompt = "You are helpful." + result.addToLlmPrompt;
```

</CodeGroup>

#### Parameters

| Parameter | Type | Default | Description |
|-----------|------|---------|-------------|
| `task` | `string` | required | Natural language task description |
| `top_k` / `topK` | `number` | `5` | Maximum number of files |
| `min_verdict_score` / `minVerdictScore` | `number` | `0.3` | Minimum verdict score |
| `prefer_complete` / `preferComplete` | `boolean` | `true` | Prefer longer/complete implementations |
| `cache_dir` / `cacheDir` | `string` | `.raysurfer_code` | Directory where files will be written. Used to generate full paths in `add_to_llm_prompt`. |

#### Returns: `GetCodeFilesResponse`

| Field | Type | Description |
|-------|------|-------------|
| `files` | `CodeFile[]` | Retrieved code files with metadata |
| `task` | `string` | The task that was searched |
| `total_found` / `totalFound` | `number` | Total matches found |
| `add_to_llm_prompt` / `addToLlmPrompt` | `string` | Pre-formatted string to append to LLM system prompt |

---

### get_few_shot_examples / getFewShotExamples

Retrieve few-shot examples for code generation prompting.

<CodeGroup>

```python Python
examples = client.get_few_shot_examples(task="Parse CSV files", k=3)

for ex in examples:
    print(f"Task: {ex.task}")
    print(f"Code: {ex.code_snippet}")
```

```typescript TypeScript
const examples = await client.getFewShotExamples("Parse CSV files", 3);

for (const ex of examples) {
  console.log(`Task: ${ex.task}`);
  console.log(`Code: ${ex.codeSnippet}`);
}
```

</CodeGroup>

---

### get_task_patterns / getTaskPatterns

Retrieve proven task-to-code mappings.

<CodeGroup>

```python Python
patterns = client.get_task_patterns(
    task="API integration",
    min_thumbs_up=5,
    top_k=20,
)

for p in patterns:
    print(f"{p.task_pattern} -> {p.code_block_name}")
```

```typescript TypeScript
const patterns = await client.getTaskPatterns({
  task: "API integration",
  minThumbsUp: 5,
  topK: 20,
});

for (const p of patterns) {
  console.log(`${p.taskPattern} -> ${p.codeBlockName}`);
}
```

</CodeGroup>

---

## Storage Methods

### upload_new_code_snip / uploadNewCodeSnip

Upload a single code file from an execution for future reuse.

<CodeGroup>

```python Python
from raysurfer.types import FileWritten

file = FileWritten(path="fetch_repos.py", content="def fetch(): ...")

# Let Raysurfer AI vote (default behavior)
result = client.upload_new_code_snip(
    task="Fetch GitHub trending repos",
    file_written=file,
    succeeded=True,
    execution_logs="Fetched 10 trending repos successfully",
)

# Or provide your own vote (AI voting is automatically skipped)
result = client.upload_new_code_snip(
    task="Fetch GitHub trending repos",
    file_written=file,
    succeeded=True,
    user_vote=1,  # 1 = thumbs up, -1 = thumbs down
)

print(f"Stored {result.code_blocks_stored} code blocks")
```

```typescript TypeScript
const file = { path: "fetch_repos.ts", content: "function fetch() { ... }" };

// Let Raysurfer AI vote (default behavior)
const result = await client.uploadNewCodeSnip(
  "Fetch GitHub trending repos",       // task
  file,                                 // code file
  true,                                 // succeeded
  undefined,                            // cachedCodeBlocks
  true,                                 // useRaysurferAiVoting (default)
  undefined,                            // userVote
  "Fetched 10 trending repos successfully", // execution logs
);

// Or provide your own vote (AI voting is automatically skipped)
const result2 = await client.uploadNewCodeSnip(
  "Fetch GitHub trending repos",
  file,
  true,
  undefined,                            // cachedCodeBlocks
  true,                                 // useRaysurferAiVoting (ignored when userVote set)
  1,                                    // userVote: 1 = thumbs up, -1 = thumbs down
);

console.log(`Stored ${result.codeBlocksStored} code blocks`);
```

</CodeGroup>

#### Parameters

| Parameter | Type | Default | Description |
|-----------|------|---------|-------------|
| `task` | `string` | required | The task that was executed |
| `file_written` / `fileWritten` | `FileWritten` | required | The file created during execution |
| `succeeded` | `boolean` | required | Whether the task completed successfully |
| `use_raysurfer_ai_voting` / `useRaysurferAiVoting` | `boolean` | `true` | Let Raysurfer AI vote on stored blocks. Ignored when `user_vote` is provided. |
| `user_vote` / `userVote` | `int \| null` | `null` | User-provided vote: `1` for thumbs up, `-1` for thumbs down. When provided, AI voting is automatically skipped. |
| `execution_logs` / `executionLogs` | `string \| null` | `null` | Captured stdout/stderr for vote context |
| `dependencies` | `dict[str, str]` / `Record<string, string>` | `null` | Package dependencies with versions (e.g., `{"pandas": "2.1.0"}`) |

<Note>
  When `use_raysurfer_ai_voting` is `true` (the default) and no `user_vote` is provided, each newly stored code block is automatically evaluated by Raysurfer's AI. If you provide a `user_vote`, AI voting is skipped entirely — your vote is applied directly.
</Note>

---

### upload_bulk_code_snips / uploadBulkCodeSnips

Bulk upload prompts, logs, and code files for sandboxed grading. The backend runs a grader that votes thumbs up/down for each code file.

<CodeGroup>

```python Python
from raysurfer.types import FileWritten, LogFile

files = [
    FileWritten(path="app.py", content="def main(): ..."),
    FileWritten(path="utils.py", content="def helper(): ..."),
]

logs = [
    LogFile(path="logs/run.log", content="Task completed", encoding="utf-8"),
]

# Let Raysurfer AI grade each file (default behavior)
result = client.upload_bulk_code_snips(
    prompts=["Build a CLI tool", "Add CSV support"],
    files_written=files,
    log_files=logs,
)

# Or provide your own votes (AI grading is automatically skipped)
result = client.upload_bulk_code_snips(
    prompts=["Build a CLI tool", "Add CSV support"],
    files_written=files,
    log_files=logs,
    user_votes={
        "app.py": 1,     # thumbs up
        "utils.py": -1,  # thumbs down
    },
)

print(result.message)
```

```typescript TypeScript
const files = [
  { path: "app.ts", content: "function main() { ... }" },
  { path: "utils.ts", content: "function helper() { ... }" },
];

const logs = [
  { path: "logs/run.log", content: "Task completed", encoding: "utf-8" },
];

// Let Raysurfer AI grade each file (default behavior)
const result = await client.uploadBulkCodeSnips(
  ["Build a CLI tool", "Add CSV support"],
  files,
  logs,
);

// Or provide your own votes (AI grading is automatically skipped)
const result2 = await client.uploadBulkCodeSnips(
  ["Build a CLI tool", "Add CSV support"],
  files,
  logs,
  true,                                    // useRaysurferAiVoting (ignored when userVotes set)
  { "app.ts": 1, "utils.ts": -1 },        // userVotes
);

console.log(result.message);
```

</CodeGroup>

#### Parameters

| Parameter | Type | Default | Description |
|-----------|------|---------|-------------|
| `prompts` | `string[]` | required | Ordered list of raw user prompts |
| `files_written` / `filesWritten` | `FileWritten[]` | required | Code files to store and grade |
| `log_files` / `logFiles` | `LogFile[]` | `null` | Log files (any format; use `encoding: "base64"` for binary) |
| `use_raysurfer_ai_voting` / `useRaysurferAiVoting` | `boolean` | `true` | Let Raysurfer AI grade and vote on stored blocks. Ignored when `user_votes` is provided. |
| `user_votes` / `userVotes` | `dict[str, int] \| null` | `null` | Dict of filename to vote (`1` = thumbs up, `-1` = thumbs down). When provided, AI grading is automatically skipped. |

<Note>
  When providing `user_votes`, the keys should match the file paths in `files_written`. You don't need to vote on every file — only the files you include will receive votes. AI grading is entirely skipped when `user_votes` is provided.
</Note>

---

### store_code_block / storeCodeBlock

Store a code block with full metadata (advanced usage).

<CodeGroup>

```python Python
result = client.store_code_block(
    name="GitHub User Fetcher",
    source="def fetch_user(username): ...",
    entrypoint="fetch_user",
    language="python",
    description="Fetches user data from GitHub API",
    tags=["github", "api", "user"],
    dependencies={"httpx": "0.27.0", "pydantic": "2.5.0"},
)
```

```typescript TypeScript
const result = await client.storeCodeBlock({
  name: "GitHub User Fetcher",
  source: "function fetchUser(username) { ... }",
  entrypoint: "fetchUser",
  language: "typescript",
  description: "Fetches user data from GitHub API",
  tags: ["github", "api", "user"],
  dependencies: { "node-fetch": "3.3.0" },
});
```

</CodeGroup>

#### Parameters

| Parameter | Type | Description |
|-----------|------|-------------|
| `name` | `string` | Human-readable name |
| `source` | `string` | The code source |
| `entrypoint` | `string` | Main function/method name |
| `language` | `string` | Programming language |
| `description` | `string` | Description of what the code does |
| `input_schema` / `inputSchema` | `object` | JSON schema for inputs |
| `output_schema` / `outputSchema` | `object` | JSON schema for outputs |
| `language_version` / `languageVersion` | `string` | Language version |
| `dependencies` | `dict[str, str]` / `Record<string, string>` | Package name to version mapping (e.g., `{"pandas": "2.1.0"}`) |
| `tags` | `string[]` | Searchable tags |
| `capabilities` | `string[]` | What the code can do |
| `example_queries` / `exampleQueries` | `string[]` | Example task queries |

---

## Voting Methods

### vote_code_snip / voteCodeSnip

Vote on whether a cached code snippet was useful. This triggers background voting on the backend.

<CodeGroup>

```python Python
client.vote_code_snip(
    task="Fetch GitHub trending repos",
    code_block_id="abc123",
    code_block_name="github_fetcher",
    code_block_description="Fetches trending repos",
    succeeded=True,
)
```

```typescript TypeScript
await client.voteCodeSnip({
  task: "Fetch GitHub trending repos",
  codeBlockId: "abc123",
  codeBlockName: "github_fetcher",
  codeBlockDescription: "Fetches trending repos",
  succeeded: true,
});
```

</CodeGroup>

<Note>
  Voting is triggered automatically by `upload_new_code_snip` / `uploadNewCodeSnip` when `use_raysurfer_ai_voting` is `true` (the default), and also by the high-level `RaysurferClient`. You can provide `user_vote` / `user_votes` to vote yourself (AI voting is skipped). Use `vote_code_snip` / `voteCodeSnip` directly only for voting on cached blocks after reuse.
</Note>

---

## Types

### CodeBlock

A stored code block with metadata.

| Field | Type | Description |
|-------|------|-------------|
| `id` | `string` | Unique identifier |
| `name` | `string` | Human-readable name |
| `description` | `string` | What the code does |
| `source` | `string` | The actual code |
| `entrypoint` | `string` | Main function name |
| `language` | `string` | Programming language |
| `language_version` / `languageVersion` | `string \| null` | Language version |
| `dependencies` | `dict[str, str]` / `Record<string, string>` | Package name to version mapping (e.g., `{"pandas": "2.1.0"}`) |
| `tags` | `string[]` | Searchable tags |
| `capabilities` | `string[]` | What it can do |
| `input_schema` / `inputSchema` | `object` | Input JSON schema |
| `output_schema` / `outputSchema` | `object` | Output JSON schema |

### SearchMatch

A code block match from unified search.

| Field | Type | Description |
|-------|------|-------------|
| `code_block` / `codeBlock` | `CodeBlock` | The code block |
| `combined_score` / `combinedScore` | `number` | Overall score (0.6 x similarity + 0.25 x verdict + 0.15 x confidence + resilience) |
| `vector_score` / `vectorScore` | `number` | Semantic similarity |
| `verdict_score` / `verdictScore` | `number` | Quality rating |
| `error_resilience` / `errorResilience` | `number` | Error handling score |
| `thumbs_up` / `thumbsUp` | `number` | Positive votes |
| `thumbs_down` / `thumbsDown` | `number` | Negative votes |
| `filename` | `string` | Generated filename |
| `language` | `string` | Programming language |
| `entrypoint` | `string` | Main function name |
| `dependencies` | `dict[str, str]` / `Record<string, string>` | Package name to version mapping |

### FileWritten

A file written during agent execution.

| Field | Type | Description |
|-------|------|-------------|
| `path` | `string` | File path |
| `content` | `string` | File contents |

### FewShotExample

A few-shot example for prompting.

| Field | Type | Description |
|-------|------|-------------|
| `task` | `string` | The task description |
| `input_sample` / `inputSample` | `object` | Example input |
| `output_sample` / `outputSample` | `any` | Example output |
| `code_snippet` / `codeSnippet` | `string` | The code |

### TaskPattern

A proven task-to-code mapping.

| Field | Type | Description |
|-------|------|-------------|
| `task_pattern` / `taskPattern` | `string` | Task description pattern |
| `code_block_id` / `codeBlockId` | `string` | Associated code block |
| `code_block_name` / `codeBlockName` | `string` | Code block name |
| `thumbs_up` / `thumbsUp` | `number` | Positive votes |
| `thumbs_down` / `thumbsDown` | `number` | Negative votes |
| `verdict_score` / `verdictScore` | `number` | Quality rating |

---

## Enums

### ExecutionState

Technical execution outcome.

| Value | Description |
|-------|-------------|
| `COMPLETED` | Execution finished successfully |
| `ERRORED` | Execution threw an error |
| `TIMED_OUT` | Execution exceeded time limit |
| `CANCELLED` | Execution was cancelled |

### AgentVerdict

Agent's judgment on execution quality.

| Value | Description |
|-------|-------------|
| `THUMBS_UP` | Execution was useful |
| `THUMBS_DOWN` | Execution was not useful |
| `PENDING` | Not yet evaluated |

### SnipsDesired

Scope of private snippets for retrieval.

| Value | Required Tier | Description |
|-------|---------------|-------------|
| `company` | TEAM or ENTERPRISE | Organization-level snippets |
| `client` | ENTERPRISE only | Client workspace snippets |

---

## Exceptions

<Note>
  Both SDKs include built-in retry logic with exponential backoff for transient failures (429, 5xx, network errors). You don't need to implement your own retry logic for these cases.
</Note>

### RaySurferError

Base exception for all Raysurfer errors.

### APIError

Raised when the API returns an error response.

| Property | Type | Description |
|----------|------|-------------|
| `message` | `string` | Error message |
| `status_code` / `statusCode` | `number` | HTTP status code |

### AuthenticationError

Raised when the API key is invalid or missing.

### CacheUnavailableError

Raised when the cache backend is unreachable or returns an unexpected error.

### RateLimitError

Raised when the API rate limit is exceeded. The SDK automatically retries with exponential backoff before raising this error.

| Property | Type | Description |
|----------|------|-------------|
| `message` | `string` | Error message |
| `retry_after` / `retryAfter` | `number \| null` | Seconds until rate limit resets |

### ValidationError

Raised when request validation fails.

| Property | Type | Description |
|----------|------|-------------|
| `message` | `string` | Error message |
| `field` | `string \| null` | The field that failed validation |
